!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Fingerprint=t()}(this,function(){"use strict";function u(e,t,r,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(function(t){t=function(a){var u,e=Object.prototype,s=e.hasOwnProperty,t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",o=t.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o,i,a,c,t=t&&t.prototype instanceof v?t:v,t=Object.create(t.prototype),n=new A(n||[]);return t._invoke=(o=e,i=r,a=n,c=l,function(e,t){if(c===d)throw new Error("Generator is already running");if(c===p){if("throw"===e)throw t;return L()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=t.iterator[r.method];if(n===u){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=u,e(t,r),"throw"===r.method))return g;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}n=h(n,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,g;n=n.arg;if(!n)return r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g;{if(!n.done)return n;r[t.resultName]=n.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=u)}r.delegate=null;return g}(r,a);if(r){if(r===g)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(c===l)throw c=p,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);c=d;r=h(o,i,a);if("normal"===r.type){if(c=a.done?p:f,r.arg!==g)return{value:r.arg,done:a.done}}else"throw"===r.type&&(c=p,a.method="throw",a.arg=r.arg)}}),t}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=c;var l="suspendedStart",f="suspendedYield",d="executing",p="completed",g={};function v(){}function y(){}function w(){}var t={},m=(i(t,n,function(){return this}),Object.getPrototypeOf),m=m&&m(m(O([]))),x=(m&&m!==e&&s.call(m,n)&&(t=m),w.prototype=v.prototype=Object.create(t));function k(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function b(a,c){var t;this._invoke=function(r,n){function e(){return new c(function(e,t){!function t(e,r,n,o){var i,e=h(a[e],a,r);if("throw"!==e.type)return(r=(i=e.arg).value)&&"object"==typeof r&&s.call(r,"__await")?c.resolve(r.__await).then(function(e){t("next",e,n,o)},function(e){t("throw",e,n,o)}):c.resolve(r).then(function(e){i.value=e,n(i)},function(e){return t("throw",e,n,o)});o(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function O(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(s.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=u,e.done=!0,e}).next=e}return{next:L}}function L(){return{value:u,done:!0}}return i(x,"constructor",y.prototype=w),i(w,"constructor",y),y.displayName=i(w,o,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,i(e,o,"GeneratorFunction")),e.prototype=Object.create(x),e},a.awrap=function(e){return{__await:e}},k(b.prototype),i(b.prototype,r,function(){return this}),a.AsyncIterator=b,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new b(c(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},k(x),i(x,o,"Generator"),i(x,n,function(){return this}),i(x,"toString",function(){return"[object Generator]"}),a.keys=function(r){var e,n=[];for(e in r)n.push(e);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=O,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&s.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=u)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=u),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=s.call(o,"catchLoc"),c=s.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&s.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}var i=(o=o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc?null:o)?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,o=this.tryEntries[t];if(o.tryLoc===e)return"throw"===(r=o.completion).type&&(n=r.arg,E(o)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:O(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=u),g}},a}(t.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})(e={exports:{}});var e,a=e.exports;return function(){function r(e){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");this.version="1.1.0",this.idTypes=new Set(["wxOpenID","qqOpenID","guid","pacUid","h5Qimei"]),this.userIdMap={},this.localIp="",this.q36cookiekey="q36cookiekey",this.cookieExDays=36500,this.uuidKey="qmuuk";var t=Array.prototype.map,a=Array.prototype.forEach;e&&(this.hasher=e),this.each=function(e,t,r){if(null!=e)if(a&&e.forEach===a)e.forEach(t,r);else if(e.length===+e.length){for(var n=0,o=e.length;n<o;n++)if(t.call(r,e[n],n,e)==={})return}else for(var i in e)if(e.hasOwnProperty(i)&&t.call(r,e[i],i,e)==={})return},this.map=function(e,n,o){var i=[];return null==e?i:t&&e.map===t?e.map(n,o):(this.each(e,function(e,t,r){i[i.length]=n.call(o,e,t,r)}),i)}}var e,t,n,c,o;return e=r,(t=[{key:"setUserId",value:function(e){var t=this,r="userID 类型错误";if(e&&"object"!==Object.prototype.toString.call(e).split(/\s/)[1].slice(0,-1).toLowerCase())throw new Error(r);if(!Object.keys(e).every(function(e){return t.idTypes.has(e)}))throw new Error(r);this.userIdMap=e}},{key:"getQimei36",value:function(o,i){var a=this;this.getHid().then(function(e){var t=a.getPlatform(),r="3BJr"+o.substring(0,2)+(e&&e.substring(3,7)),n=new XMLHttpRequest,e=(n.open("POST","https://snowflake.qq.com/ola/h5",!0),n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE&&200==n.status)try{var e=JSON.parse(n.responseText),t=e.q36;t&&a.saveCookieQ36(t),i&&i(e)}catch(e){i(null)}},{appKey:o,hid:e,sign:r,version:a.version,userId:JSON.stringify(a.userIdMap),platform:t,localIp:a.localIp,uuid:a.getUuid(),resolution:a.getResolution(),q36:a.getCookieQ36()});n.send(JSON.stringify(e))})}},{key:"getHid",value:(c=a.mark(function e(){var r,n=this;return a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=[]).push((t=void 0,(t=[Math.floor(window.screen.width*window.devicePixelRatio),Math.floor(window.screen.height*window.devicePixelRatio)]).sort().reverse(),t.join("x"))),r.push((t=void 0,(t=[Math.floor(window.screen.availWidth*window.devicePixelRatio),Math.floor(window.screen.availHeight*window.devicePixelRatio)]).sort().reverse(),t.join("x"))),r.push(navigator.deviceMemory),r.push(!!window.sessionStorage),r.push(!!window.indexedDB),r.push(navigator.productSub),r.push(navigator.hardwareConcurrency),r.push(this.getWebglVendorAndRenderer()),r.push((new Date).getTimezoneOffset()),e.next=12,this.getFactor().then(function(e){e&&(r.push(e),n.localIp=e)}).catch(function(){});case 12:if(this.hasher)return e.abrupt("return",this.hasher(r.join("###"),31));e.next=16;break;case 16:return e.abrupt("return",this.x64hash128(r.join("###"),31));case 17:case"end":return e.stop()}var t},e,this)}),o=function(){var e=this,a=arguments;return new Promise(function(t,r){var n=c.apply(e,a);function o(e){u(n,t,r,o,i,"next",e)}function i(e){u(n,t,r,o,i,"throw",e)}o(void 0)})},function(){return o.apply(this,arguments)})},{key:"getResolution",value:function(){return[Math.floor(window.screen.availWidth*window.devicePixelRatio),Math.floor(window.screen.availHeight*window.devicePixelRatio)].sort().reverse().join("x")}},{key:"getCookieQ36",value:function(){return this.getCookie(this.q36cookiekey)}},{key:"saveCookieQ36",value:function(e){this.setCookie(this.q36cookiekey,e,this.cookieExDays)}},{key:"getUuid",value:function(){if(!navigator.cookieEnabled)return null;var e=this.uuidKey,t=this.getCookie(e);return t||(t=this.buildUuid(),this.setCookie(e,t,this.cookieExDays),t)}},{key:"buildUuid",value:function(){var e=Date.now(),t=this.getRanHex(19);return e.toString()+t}},{key:"getRanHex",value:function(e){for(var t=[],r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],n=0;n<e;n++)t.push(r[Math.floor(16*Math.random())]);return t.join("")}},{key:"setCookie",value:function(e,t,r){var n=new Date,r=(n.setTime(n.getTime()+24*r*60*60*1e3),"expires="+n.toGMTString());document.cookie=e+"="+t+"; "+r}},{key:"getCookie",value:function(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){var o=r[n].trim();if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}},{key:"getUserAgent",value:function(){return navigator.userAgent}},{key:"getNative",value:function(){var t=this;this.getHid().then(function(e){JSInterface.callback(t.version,e,t.getUserAgent())})}},{key:"getPlatform",value:function(){return navigator.platform}},{key:"isIphoneOrIpad",value:function(){var e=navigator.userAgent,t=e.indexOf("iPhone"),r=e.indexOf("iPad"),e=e.indexOf("Mac");return-1!=t||-1!=r||-1!=e}},{key:"getWebglVendorAndRenderer",value:function(){try{var e=function(){var e=document.createElement("canvas"),t=null;try{t=e.getContext("webgl")||e.getContext("experimental-webgl")}catch(e){}return t=t||null}(),t=e.getExtension("WEBGL_debug_renderer_info"),r=[e.getParameter(t.UNMASKED_VENDOR_WEBGL),e.getParameter(t.UNMASKED_RENDERER_WEBGL)].join("~"),n=e.getExtension("WEBGL_lose_context");return null!=n&&n.loseContext(),r}catch(e){return null}}},{key:"getFactor",value:function(){var c=this;return new Promise(function(n,t){var e,r,o;function i(e){if(!(e in o)){o[e]=!0;for(var t=Object.keys(o).filter(function(e){return o[e]}),r=0;r<t.length;r++)16<t[r].length&&(t.splice(r,1),r--);n(t[0])}}function a(e){(0<arguments.length&&void 0!==e?e:"").split("\r\n").forEach(function(e,t,r){var n,o;~e.indexOf("a=candidate")?(o=(n=e.split(" "))[4],"host"===n[7]&&i(o)):~e.indexOf("c=")&&i(e.split(" ")[2])})}(e=c.isIphoneOrIpad()?window.webkitRTCPeerConnection||window.mozRTCPeerConnection:window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection)||t(),e?((r=new e({iceServers:[]})).createDataChannel("",{reliable:!1}),r.onicecandidate=function(e){e.candidate?a("a=".concat(e.candidate.candidate)):t()},r.createOffer(function(e){a(e.sdp),r.setLocalDescription(e)},function(e){console.warn("offer failed!",e)}),(o=Object.create(null))["0.0.0.0"]=!1):n(null)})}},{key:"x64hash128",value:function(e,t){for(var r=function(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]+t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]+t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]+t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]+t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]},n=function(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]*t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]*t[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=e[3]*t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]*t[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[2]*t[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[3]*t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]},o=function(e,t){return 32===(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:[e[1]<<(t-=32)|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t]},i=function(e,t){return 0===(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]},a=function(e,t){return[e[0]^t[0],e[1]^t[1]]},c=function(e){return e=a(e,[0,e[0]>>>1]),e=n(e,[4283543511,3981806797]),e=a(e,[0,e[0]>>>1]),e=n(e,[3301882366,444984403]),e=a(e,[0,e[0]>>>1])},u=(e=e||"").length%16,s=e.length-u,h=[0,t=t||0],l=[0,t],f=[0,0],d=[0,0],p=[2277735313,289559509],g=[1291169091,658871167],v=0;v<s;v+=16)f=[255&e.charCodeAt(v+4)|(255&e.charCodeAt(v+5))<<8|(255&e.charCodeAt(v+6))<<16|(255&e.charCodeAt(v+7))<<24,255&e.charCodeAt(v)|(255&e.charCodeAt(v+1))<<8|(255&e.charCodeAt(v+2))<<16|(255&e.charCodeAt(v+3))<<24],d=[255&e.charCodeAt(v+12)|(255&e.charCodeAt(v+13))<<8|(255&e.charCodeAt(v+14))<<16|(255&e.charCodeAt(v+15))<<24,255&e.charCodeAt(v+8)|(255&e.charCodeAt(v+9))<<8|(255&e.charCodeAt(v+10))<<16|(255&e.charCodeAt(v+11))<<24],f=o(f=n(f,p),31),f=n(f,g),h=r(h=o(h=a(h,f),27),l),h=r(n(h,[0,5]),[0,1390208809]),d=o(d=n(d,g),33),d=n(d,p),l=r(l=o(l=a(l,d),31),h),l=r(n(l,[0,5]),[0,944331445]);switch(f=[0,0],d=[0,0],u){case 15:d=a(d,i([0,e.charCodeAt(v+14)],48));case 14:d=a(d,i([0,e.charCodeAt(v+13)],40));case 13:d=a(d,i([0,e.charCodeAt(v+12)],32));case 12:d=a(d,i([0,e.charCodeAt(v+11)],24));case 11:d=a(d,i([0,e.charCodeAt(v+10)],16));case 10:d=a(d,i([0,e.charCodeAt(v+9)],8));case 9:d=a(d,[0,e.charCodeAt(v+8)]),d=o(d=n(d,g),33),d=n(d,p),l=a(l,d);case 8:f=a(f,i([0,e.charCodeAt(v+7)],56));case 7:f=a(f,i([0,e.charCodeAt(v+6)],48));case 6:f=a(f,i([0,e.charCodeAt(v+5)],40));case 5:f=a(f,i([0,e.charCodeAt(v+4)],32));case 4:f=a(f,i([0,e.charCodeAt(v+3)],24));case 3:f=a(f,i([0,e.charCodeAt(v+2)],16));case 2:f=a(f,i([0,e.charCodeAt(v+1)],8));case 1:f=a(f,[e.charCodeAt(v)]),f=o(f=n(f,p),31),f=n(f,g),h=a(h,f)}return h=a(h,[0,e.length]),l=r(l=a(l,[0,e.length]),h=r(h,l)),h=c(h),l=r(l=c(l),h=r(h,l)),("00000000"+(h[0]>>>0).toString(16)).slice(-8)+("00000000"+(h[1]>>>0).toString(16)).slice(-8)+("00000000"+(l[0]>>>0).toString(16)).slice(-8)+("00000000"+(l[1]>>>0).toString(16)).slice(-8)}}])&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),r}()});
