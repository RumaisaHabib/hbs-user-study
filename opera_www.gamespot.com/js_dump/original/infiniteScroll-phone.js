(function(t){"use strict";var e=t.Phoenix,l,n;if(!e){t.Phoenix=e={}}l=e.InfiniteScroll=e.InfiniteScroll||{};l.Models=l.Models||{};n=l.Models.Page=Backbone.Model.extend({monitor:null,attributes:{id:null,length:null,html:null},initialize:function(t){this.set("html",$(t.html))},set:function(t,e,l){return Backbone.Model.prototype.set.call(this,t,e,_.extend({silent:true},l))}})})(this);
(function(e){"use strict";var t=e.Phoenix,n,i;if(!t){e.Phoenix=t={}}n=t.InfiniteScroll=t.InfiniteScroll||{};n.Collections=n.Collections||{};var r=function(e,t){if(!t.length){return t}var n=0,i=[],r;for(n=0;n<t.length;n++){r=t[n];if(!(e.has(r)||e.isFetching(r))){i.push(r)}}return i};var f=function(e,t,n){var i=0,r;for(i=0;i<t.length;i++){r=t[i];if(n){e.fetching[r]=true}else{delete e.fetching[r]}}};i=n.Collections.Pages=Backbone.Collection.extend({InfiniteScroll:null,fetching:{},model:n.Models.Page,initialize:function(e,t){var n=this;if(t.url){n.url=t.url}},comparator:function(e){return e.get("id")},fetch:function(e){var t=this,n=[];if(e&&e.data){if(e.data.page){n.push(e.data.page)}else if(e.data.pages){n=e.data.pages}if(n.length){n=r(t,n)}}if(!n.length){return}f(t,n,true);return Backbone.Collection.prototype.fetch.call(t,{remove:false,data:e.data,beforeSend:function(){},complete:function(i,r){f(t,n,false);if(e.complete){e.complete(i,r)}},error:function(e,n,i){t.trigger("fetchError")}})},getFirstPageNumber:function(){return this.first().get("id")},getLastPageNumber:function(){return this.last().get("id")},has:function(e){if(!e){return false}return undefined!==this.get(e)},isFetching:function(e){if(!e){return false}return true===this.fetching[e]}})})(this);
(function(e){"use strict";var t=$(document),n=e.Phoenix,a,i;if(!n){e.Phoenix=n={}}a=n.InfiniteScroll=n.InfiniteScroll||{};a.Views=a.Views||{};var s=".js-mapped-ad";var l=s+" .ad-wrap";i=a.Views.Ads=Backbone.View.extend({InfiniteScroll:null,eventName:"pageLoad",states:{currentPage:null,hasAds:false,hasLoaded:false},els:{$ads:null},initialize:function(e){var t=this,n=t.InfiniteScroll=e.InfiniteScroll;t.els.$ads=e.$ads;n.on("prePageLoad",(function(e){t.prepAds(e)}));n.on("pageLoad",(function(e){if(t.states.hasAds){t.getAds(e)}}));t.states.hasLoaded=true},prepAds:function(e){var t=this,n=t.InfiniteScroll,a=n.collection.get(e),i=t.states,l=true,d=a.get("html"),o=d.find(s);i.currentPage=n.states.currentPage;if(i.currentPage>e){o.remove();o=null;a.set("html",d)}if(!o||o.length<1){l=false}i.hasAds=l},getAds:function(e){var t=this,n=t.InfiniteScroll,a=n.collection.get(e),i=a.get("html"),s=i.find(l),d=t.eventName,o=d+"-"+e;s.attr("data-ad-event",o);document.dispatchEvent(new CustomEvent("on_ad_event",{detail:{adContext:o,adContextOverrides:{extendsAdContext:d,adContextElement:i[0],newTargeting:true}}}))}})})(this);
(function(e){"use strict";var t=$(document),a=$(window),i=e.scrollMonitor,r=e.Phoenix,n,o;if(!r){e.Phoenix=r={}}n=r.InfiniteScroll=r.InfiniteScroll||{};n.Views=n.Views||{};var s="hide";var l=".js-infinite-scroll__river-item";var g=function(){var e,t;var a=function(){var a=i.viewportTop,r=e-a;e=a;if(r===0){t.hasChange=false;t.isScrollUp=false;t.isScrollDown=false}else{t.hasChange=true;if(r>0){t.isScrollUp=true;t.isScrollDown=false}else{t.isScrollUp=false;t.isScrollDown=true}}};return function(r){if(!t){e=i.viewportTop;t={hasChange:false,isScrollUp:false,isScrollDown:false}}else if(r){a()}return t}}();var f=function(e){var t,a,r,n,o,s,l;if(!e){return}l=e.closest(".js-infinite-scroll__river-page");t=l.offset();t.height=l.height();t.bottom=t.top+t.height;a=e.offset();a.height=e.outerHeight();a.bottom=a.top+a.height;r=a.top;n=a.bottom;i.recalculateLocations();o=i.viewportTop;s=i.viewportBottom;return Math.min(r,o+t.bottom-s)};var c=function(e,t){var i,r;if(!t){return}r=$("#"+t);i=f(r);if(i){a.one("scroll",(function(){e.trigger("scrollToLocationHash")}));document.body.scrollTop=i}else{e.trigger("scrollToLocationHash")}};var u=function(e){e.on("prePageLoad",(function(){document.dispatchEvent(new Event("pre_page_event"))}));e.on("pageLoad",(function(e){let t=new URLSearchParams(location.search);t.set("page",e);t=t.toString().length>0?`?${t.toString()}`:"";const a=location.origin+location.pathname+t;document.dispatchEvent(new CustomEvent("on_tracking_event",{detail:{eventName:"pageLoad",trackingParamsOverride:{cb:{path:a}}}}))}))};var d=function(e,t){let a=new URLSearchParams(window.location.search);if(e>1){a.set("page",e)}else if(a.has("page")){a.delete("page")}let i=a.toString().length>0?`?${a.toString()}`:"";if(t){if(!i.length){i="#"}i+="#"+t}if(!i.length){i=window.location.pathname}return i};var h=function(e,t){var a=t.data("url");if(undefined===a){a=d(e,t.attr("id"));t.data("url",a)}return a};var P=function(e,t){var a=t.data("url");if(undefined===a){a=d(e);t.data("url",a)}return a};var v=function(e,t){var r=function(t){e.loadPage(t)};var n=i.create(e.el,{top:-600,bottom:-300});var o=i.create(e.el);var s=function(){g();a.on("scroll.infinite",(function(){var t=g(true),a=e.states,i=false;if(true===t.hasChange){e.states.loadingPage=false;if(true===t.isScrollUp&&false===n.isAboveViewport&&a.currentPage>1){r(-1);i=true}else if(true===t.isScrollDown&&false===n.isBelowViewport&&a.currentPage<a.lastPage){r(1);i=true}}}));e.on("riverComplete",(function(){a.off("scroll.infinite")}))};if(t){e.on("scrollToLocationHash",(function(){e.off("scrollToLocationHash");s()}));setTimeout((function(){try{c(e,t)}catch(e){}}),0)}else{s()}return o};var p=function(){return function(e,t,a){var r=a.find(l);var n=i.create(a);n.stateChange((function(){if(n.isInViewport){P(t,a);e.setCurrentPage(t,a)}}));r.each((function(){var a=$(this);h(t,a);a.on("click.infiniteScroll",(function(){e.setCurrentItem(t,a)}))}))}}();o=n.Views.Core=Backbone.View.extend({Router:null,states:{currentPage:1,currentIndex:0,itemsPerPage:10,maxPages:10,firstPage:1,lastPage:10,loadingPage:true,loadingTimeoutId:null,insertingPage:false,waitingForPage:false},pagesInserted:{},els:{$eol:null,$loadingTop:null,$loadingBottom:null,$riverBody:null},watcher:null,initialize:function(e){var t=this,a=t.collection,i,r;t.Router=e.Router;_.extend(t.states,t.$el.data("states"));r=t.states;i=r.currentPage;r.lastPage=r.firstPage+r.maxPages-1;t.pagesInserted[i]=true;t.els.$eol=e.$eol;t.els.$loadingTop=t.$(".js-infinite-scroll__loading-top");t.els.$loadingBottom=t.$(".js-infinite-scroll__loading-bottom");t.els.$riverBody=e.$riverBody;t.toggleEndOfList(i===r.lastPage);t.watcher=v(t,e.locationHash);p(t,i,a.get(i).get("html"));a.on("add",(function(e){var a=e.get("id");if(a===r.waitingForPage){r.waitingForPage=false;t.insertPage(a)}}));a.on("fetchError",(function(){t.states.firstPage=a.getFirstPageNumber();t.states.lastPage=a.getLastPageNumber();t.toggleLoading();t.toggleEndOfList(true)}));u(t)},setCurrentPage:function(e,t){var a=this,i=a.states,r=i.currentPage;if(r===e){return}i.currentPage=e;if(e===1){a.clear()}else{i.currentPage=e;a.navigate(P(e,t))}},setCurrentItem:function(e,t){var a=this,i=a.states,r=i.currentIndex,n=t.data("index");if(r===n){return}i.currentIndex=n;i.currentPage=e;a.navigate(h(e,t))},clear:function(){var e=this,t=e.states;t.currentIndex=0;t.currentPage=1;e.navigate(d(1))},navigate:function(e){var t=this.Router;if(null!==t){t.navigate(e)}},fetchPage:function(e){var t=this,a=t.states,i=t.collection;if(e<a.firstPage||e>a.lastPage){return}i.fetch({data:{page:e}})},fetchPages:function(e,t){var a=this,i=a.collection,r=a.states,n=i.getFirstPageNumber(),o=i.getLastPageNumber(),s=[],l,g,f=false;if(t>0){l=o+t;if(e===o-1){f=true;g=o}}else{l=n+t;if(e===n+1){f=true;g=n}}while(f){if(l<r.firstPage||l>r.lastPage){f=false;break}if(!(i.isFetching(l)||i.has(l))){s.push(l)}l+=t;f=Math.abs(l-g)<=2}if(!s.length){return}if(s.length){i.fetch({data:{pages:s}})}},waitForPage:function(e){var t=this,a=t.states,i=a.currentPage,r=t.collection;if(false===r.isFetching(e)){t.fetchPage(e)}if(i<e){a.waitingForPage=i+1}else if(i>e){a.waitingForPage=i-1}},loadPage:function(e){var t=this,a=t.states,i=t.collection,r=a.currentPage,n=r+e;if(false===t.isValidInsertPageNumber(n)){return}t.toggleLoading(n);if(false===i.has(n)){t.waitForPage(n);return}r=a.currentPage;if(false===t.watcher.isBelowViewport&&n>r||false===t.watcher.isAboveViewport&&n<r){a.loadingPage=true;a.loadingTimeoutId=setTimeout((function(){a.loadingPage=false;a.loadingTimeoutId=null;t.insertPage(n)}),200)}else{t.insertPage(n)}t.fetchPages(n,e)},insertPage:function(e){var t=this,a=t.states,r=t.pagesInserted,n=a.currentPage,o=t.els.$riverBody,s=t.collection,l,g;if(false===t.isValidInsertPageNumber(e)){return}a.insertingPage=true;t.trigger("prePageLoad",e);l=s.get(e);g=l.get("html");if(n<e){g.appendTo(o)}else if(n>e){g.prependTo(o);window.scrollTo(0,i.viewportTop+g.height())}t.toggleLoading();r[e]=true;p(t,e,g);if(e===a.lastPage){t.toggleEndOfList(true)}if(r[a.firstPage]&&r[a.lastPage]){t.trigger("riverComplete")}t.trigger("pageLoad",e);a.insertingPage=false},toggleLoading:function(e){var t=this,a=t.states,i=a.currentPage,r=t.els,n=r.$loadingTop,o=r.$loadingBottom;if(!!e){if(e>i){n.addClass(s);o.removeClass(s)}else{n.removeClass(s);o.addClass(s)}}else{n.addClass(s);o.addClass(s)}},toggleEndOfList:function(e){var t=this,a=t.els.$eol,i,r=1,n,o,l;if(!a||a.length<1){return}if(e){if(t.states.lastPage>1){i=a.find("a");n=i.attr("href");o=new URLSearchParams(i[0].search);l=i.data("pagination");if(l){r=Math.ceil(t.states.lastPage*t.states.itemsPerPage/l);o.set("page",r)}if(r>1){i.attr("href",`${n}?${o.toString()}`)}}a.removeClass(s)}else{a.addClass(s)}},isValidInsertPageNumber:function(e){var t=this.states;if(e===t.currentPage||e<t.firstPage||e>t.lastPage||true===this.pagesInserted[e]||true===t.loadingPage||null!==t.loadingTimeoutId||true===t.insertingPage||false!==t.waitingForPage){return false}return true}})})(this);
(function(e){"use strict";var t=e.Phoenix,n;if(!t){e.Phoenix=t={}}n=t.InfiniteScroll=t.InfiniteScroll||{};n.Router=Backbone.Router.extend({routes:{"#item=:elementId":null,"?page=:page#item=:elementId":null,"?page=:page":null},navigate:function(e,t){t=_.extend({replace:true,trigger:false},t);Backbone.Router.prototype.navigate.call(this,e,t)}})})(this);
(function(i){"use strict";var e=$("#js-infinite-scroll"),r;if(!e||e.length<1){return}if(e.length>1){e=e.first()}var t=$(document),n=i.scrollMonitor||false,a=i.Phoenix||{},o=a.InfiniteScroll,s;if(!o||!n||!Backbone){if(!o){}if(!n){}return}s=o.Views;var l=".js-infinite-scroll__body";var f=".js-infinite-scroll__river-page";var u=function(){if(i.Modernizr){return i.Modernizr.history}return!!(window.history&&history.pushState)}();if(true===u){r=e.find(".js-infinite-scroll__eol");r.addClass("hide")}else{return}var c=function(i,e){var t=i.find(l),n=i.find(".js-infinite-scroll__preloaded"),a=i.data(),u={id:a.states.currentPage,html:t.find(f)},c,d;if(n&&n.length>0){d=n.data("pages");d.push(u);n.remove()}else{d=[u]}try{c=new o.Collections.Pages(d,{url:a.pageUrl})}catch(i){}var h=new s.Core({el:i,$eol:r,$riverBody:t,collection:c,Router:e.Router,locationHash:e.locationHash});c.InfiniteScroll=h;return h};var d=function(i){if(!o.Views.Ads){return}if(a&&a.hasAds&&a.hasAds()){var e=new o.Views.Ads({InfiniteScroll:i});return e}};var h=function(){if(!o.Router){return}var i=new o.Router,e=Backbone.history,r=window.location,t=e.getHash(),n=r.search,a=r.pathname;e.start({pushState:true,silent:true});if(t){if(n){a=n}i.navigate(a,{replace:true,trigger:false})}return{locationHash:t,Router:i}};o.initialize=function(){var i=h();var r=c(e,i);d(r)};var v=$(".ad-settings");if(v&&v.length>0){t.one("ads_initialized",o.initialize)}else{$(o.initialize)}})(this);